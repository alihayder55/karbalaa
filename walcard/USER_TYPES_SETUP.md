# دليل إعداد أنواع المستخدمين - ولكارد

## ملخص التغييرات الجديدة

تم إضافة نظام تصنيف المستخدمين بعد التحقق من رقم الهاتف. الآن يمكن للمستخدمين الجدد اختيار نوع حسابهم:

### 1. **تاجر (Merchant)**
- يملك شركة أو مؤسسة تجارية
- يريد بيع منتجاته للمحلات
- لديه غرفة تجارة (اختياري)
- يحدد المنتجات المتاحة لديه

### 2. **صاحب محل (Store Owner)**
- يملك محل تجاري
- يريد شراء المنتجات من التجار
- يحدد موقع المحل ونوع النشاط

## الملفات الجديدة المضافة

### 1. شاشة اختيار نوع المستخدم
```
walcard/app/auth/user-type-selection.tsx
```
- شاشة تعرض خيارين: تاجر أو صاحب محل
- تصميم جذاب مع أيقونات ووصف لكل نوع
- تنتقل لشاشة التسجيل المناسبة

### 2. شاشة تسجيل التاجر
```
walcard/app/auth/merchant-registration.tsx
```
- استمارة تسجيل التاجر بالحقول التالية:
  - اسم النشاط التجاري (مطلوب)
  - رقم غرفة التجارة (اختياري)
  - المنتجات المتاحة (مطلوب)

### 3. شاشة تسجيل صاحب المحل
```
walcard/app/auth/store-owner-registration.tsx
```
- استمارة تسجيل صاحب المحل بالحقول التالية:
  - عنوان المحل (مطلوب)
  - أقرب معلم مميز (اختياري)
  - نوع المحل (مطلوب)

## جداول قاعدة البيانات الجديدة

### جدول التجار (merchants)
```sql
- id: مفتاح أساسي
- full_name: الاسم الكامل
- business_name: اسم النشاط التجاري
- chamber_of_commerce_id: رقم غرفة التجارة (اختياري)
- phone: رقم الهاتف
- available_products: مصفوفة المنتجات المتاحة
- is_approved: حالة الموافقة (افتراضي: false)
- created_at, updated_at: تواريخ الإنشاء والتحديث
```

### جدول أصحاب المحلات (store_owners)
```sql
- id: مفتاح أساسي
- name: اسم صاحب المحل
- address: عنوان المحل
- nearest_landmark: أقرب معلم مميز (اختياري)
- latitude, longitude: إحداثيات الموقع (اختياري)
- phone: رقم الهاتف
- store_type: نوع المحل
- storefront_image: صورة واجهة المحل (اختياري)
- is_approved: حالة الموافقة (افتراضي: false)
- created_at, updated_at: تواريخ الإنشاء والتحديث
```

## تدفق التسجيل الجديد

1. **إدخال رقم الهاتف والاسم** (register.tsx)
2. **التحقق من رمز OTP** (verify.tsx)
3. **اختيار نوع المستخدم** (user-type-selection.tsx) ← **جديد**
4. **ملء استمارة التسجيل** (merchant-registration.tsx أو store-owner-registration.tsx) ← **جديد**
5. **انتظار الموافقة من الإدارة**
6. **الدخول للتطبيق**

## التحديثات على الملفات الموجودة

### verify.tsx
- تم تعديل توجيه المستخدمين الجدد إلى شاشة اختيار نوع المستخدم
- المستخدمون الحاليون يذهبون مباشرة للصفحة الرئيسية

### supabase-setup.sql
- تم إضافة جداول merchants و store_owners
- تم إضافة فهارس للبحث السريع
- تم تفعيل Row Level Security مع صلاحيات مناسبة
- تم إضافة triggers لتحديث updated_at تلقائياً

## خطوات تطبيق التحديثات

### 1. تحديث قاعدة البيانات
```bash
# تنفيذ السكريبت المحدث في Supabase Dashboard
# أو استخدام CLI:
supabase db reset
```

### 2. اختبار التدفق الجديد
1. جرب تسجيل حساب جديد
2. تأكد من ظهور شاشة اختيار نوع المستخدم
3. جرب تسجيل تاجر وصاحب محل
4. تحقق من حفظ البيانات في قاعدة البيانات

### 3. إدارة طلبات الموافقة
- جميع الطلبات تبدأ بحالة `is_approved = false`
- يجب إنشاء لوحة إدارة لمراجعة والموافقة على الطلبات
- يمكن إضافة نظام إشعارات للمستخدمين عند الموافقة

## المميزات الجديدة

### 1. نظام الموافقة
- جميع التسجيلات تحتاج موافقة إدارية
- منع الوصول غير المصرح به
- إمكانية رفض التسجيلات غير المناسبة

### 2. التصنيف حسب نوع المستخدم
- تخصيص التجربة حسب نوع المستخدم
- صلاحيات مختلفة لكل نوع
- إمكانية إضافة مميزات خاصة لكل فئة

### 3. معلومات تفصيلية
- بيانات تجارية للتجار
- معلومات موقع للمحلات
- إمكانية إضافة المزيد من التفاصيل لاحقاً

## التطوير المستقبلي

### مقترحات للتحسين
1. **إضافة رفع الصور**: صور المنتجات للتجار، صور واجهة المحل
2. **نظام التقييمات**: تقييم التجار وأصحاب المحلات
3. **الموقع الجغرافي**: استخدام GPS لتحديد مواقع المحلات
4. **إشعارات الموافقة**: إشعار المستخدمين عند الموافقة أو الرفض
5. **لوحة إدارة**: واجهة ويب لإدارة طلبات التسجيل

### نصائح الأمان
- تأكد من صحة المعلومات التجارية قبل الموافقة
- تحقق من أرقام غرفة التجارة للتجار
- راجع عناوين المحلات للتأكد من صحتها
- استخدم نظام تقييمات لمراقبة جودة الخدمة 